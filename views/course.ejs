<%- include("partials/header.ejs") %>

<div class="courselayout-y">
    <div class="side-bar-y">
        <div class="overview-y"><a href="/courses/<%= course.id %>">Overview</a></div>
        <% sections.forEach(function(section) { %>
            <div class="section"><a href="/sections/<%= section.id %>"><%= section.name %></a></div>
        <% }); %>
    </div>
    
    <div class="main-content-y">
        <div class="left-main-content-y">
            <div class="lfmc-2-y">
                <div class="lfc-heading-y">
                    <p><%= course.title %></p>
                </div>
                <div class="lfc-subheading-y">
                    <p><%= course.subtitle %></p>
                </div>
                <div class="lfc-rating-y">
                    <p>Rating: <%= averageRating.toFixed(1) %></p> 
                </div>
                <div class="lfc-instructor-y">
                    <p>Instructor: <%= course.instructor %></p>
                </div>
                <div class="lfc-level-y">
                    <p>Level: <%= course.level %></p>
                </div>
                <div class="lfc-description-y">
                    <p><%= course.description %></p>    
                </div>
            </div>
        </div>
        <div class="right-main-content-y">
            <div class="rfc-main-2-y">
                <div class="rfc-photo-y">
                    <img src="<%= course.imageUrl %>" alt="" width="300px">
                </div>
                <div class="rfc-price-y">$<%= course.price %></div>
                <div class="rfc-btn-y">
                    <button class="rfc-cart" onclick="addToCart(<%= course.id %>)">Add to Cart</button>
                    <button class="rfc-wishlist" onclick="addToWishlist(<%= course.id %>)">Add to Wishlist</button>
                    <button class="rfc-buy" onclick="buyCourse(<%= course.id %>)">Buy</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    async function addToCart(courseId) {
        const response = await fetch(`/cart/add/${courseId}`, { method: 'POST' });
        if (response.ok) {
            alert('Course added to cart!');
        } else {
            alert('Error adding course to cart');
        }
    }

    async function addToWishlist(courseId) {
        const response = await fetch(`/wishlist/add/${courseId}`, { method: 'POST' });
        if (response.ok) {
            alert('Course added to wishlist!');
        } else {
            alert('Error adding course to wishlist');
        }
    }

    function buyCourse(courseId) {
        
        window.location.href = `/payment/${courseId}`;
    }
</script>
